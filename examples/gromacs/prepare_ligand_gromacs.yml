steps:
  # Create ligand system topology
  - reduce_add_hydrogens: # Add hydrogen atoms
      in:
        input_path: '*ligand.pdb'
        output_path: '&ligand_reduce_H.pdb'
        config:
          nuclear: true
  - babel_minimize: # Minimize the system with the new hydrogen atoms
      in:
        input_path: '*ligand_reduce_H.pdb'
        output_path: '&ligand_reduce_H_min.mol2'
        config:
          method: sd
          criteria: 1e-10
          force_field: GAFF
  - python3_calculate_net_charge:
      in:
        script: /calculate_net_charge.py
        input_path: '*ligand_reduce_H_min.mol2'
        output_log_path: calc_charge_log
        net_charge: '&mol_charge'
  - acpype: # Generate ligand topology
      in:
        input_path: '*ligand_reduce_H_min.mol2'
        output_gro_path: '&ligand_params.gro'
        output_itp_path: '&ligand_params.itp'
        output_top_path: '&ligand_params.top'
        base_name:  output_acpype
        net_charge: '*mol_charge'
  # Preparing Ligand Restraints
  - make_ndx: # Creating an index file for the small molecule heavy atoms
      in:
        input_structure_path: '*ligand_params.gro'
        output_ndx_path: '&ligand_index.ndx'
        config: {"selection": "0 & ! a H*"}
  - genrestr:
      in:
        input_structure_path: '*ligand_params.gro'
        input_ndx_path: '*ligand_index.ndx'
        output_itp_path: '&ligand_posres.itp'
        config:
          force_constants: 1000 1000 1000
          restrained_group: System

wic:
  graphviz:
    label: Prepare Ligand
  steps:
    (1, reduce_add_hydrogens):
      wic:
        graphviz:
          label: Add hydrogen atoms
    (2, babel_minimize):
      wic:
        graphviz:
          label: Minimize the System
    (3, acpype_params_gmx):
      wic:
        graphviz:
          label: Generate the Ligand Topology
    (4, make_ndx):
      wic:
        graphviz:
          label: Create an Index File
    (5, genrestr):
      wic:
        graphviz:
          label: Create the Ligand Topology File