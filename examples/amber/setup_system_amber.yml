# This is based on the excellent gromacs CWL tutorial
# https://mmb.irbbarcelona.org/biobb/workflows/tutorials/amber_md_setup_lig

steps:
- pdb:
    in:
      output_pdb_path: '&1BTY.pdb'
      config: {"pdb_code": 1BTY, "filter": False}
- python3_rename_ligand_pdb:
    in:
      script: /rename_ligand.py
      input_pdb_path: '*1BTY.pdb'
      output_pdb_path: '&system_complex.pdb'
      ligand_name: BEN
      ligand_new_name: MOL
- extract_molecule:
    in:
      input_structure_path: '*system_complex.pdb'
      output_molecule_path: '&protein.pdb'
- prepare_protein_amber.yml:
- extract_heteroatoms:
    in:
      input_structure_path: '*system_complex.pdb'
      output_heteroatom_path: '&ligand.pdb'
      config: {'heteroatoms' : [{"name": "MOL"}]}
- prepare_ligand_amber.yml:
- create_complex_amber.yml:
- stability_amber.yml:
    in:
      nsteps: 10000
      dt: 0.002 # ps
      temperature: 298.0 # K
      pressure: 1.0  #

# wic:
#   graphviz:
#     label: Molecular Dynamics Setup
#   steps:
#     (1, pdb):
#       wic:
#         graphviz:
#           label: Load the Complex PDB File
#     (2, rename_pdb):
#       wic:
#         graphviz:
#           label: Rename Lignad to MOL
#     (3, extract_molecule):
#       wic:
#         graphviz:
#           label: Extract Protein Coordinates
#     (4, prepare_protein):
#       wic:
#         graphviz:
#           label: Prepare Protein
#     (5, extract_heteroatoms):
#       wic:
#         graphviz:
#           label: Extract Ligand Coordinates
#     (6, prepare_ligand):
#       wic:
#         graphviz:
#           label: Prepare Ligand
#     (7, create_complex):
#       wic:
#         graphviz:
#           label: Create the Complex of Protein and Ligand
#     (8, stability):
#       wic:
#         graphviz:
#           label: Minimize, Equilibrate the System
