# This is based on the excellent gromacs CWL tutorial
# https://mmb.irbbarcelona.org/biobb/workflows/tutorials/amber_md_setup_lig
steps:
  - pdb:
      in:
        output_pdb_path: '&complex_rcsb.pdb'
        config: {"pdb_code": 1BTY, "filter": False}
  - extract_molecule:
      in:
        input_structure_path: '*complex_rcsb.pdb'
        output_molecule_path: '&protein.pdb'
  - prepare_protein_amber.yml:
  - extract_heteroatoms:
      in:
        input_structure_path: '*complex_rcsb.pdb'
        output_heteroatom_path: '&ligand_rcsb.pdb'
        config: {'heteroatoms' : [{"name": "BEN"}]}
  - python3_pdb_to_pdb:
      in:
        script: /rename_residues_MOL.py # NOTE: Initial / required
        input_pdb_path: '*ligand_rcsb.pdb'
        output_pdb_path: '&ligand.pdb'
        ligand_residue_name: BEN
  - prepare_ligand_amber.yml:
  - create_complex_amber.yml:
  - stability_amber.yml:
      in:
        nsteps: 200
        dt: 0.002 # ps
        temperature: 298.0 # K
        pressure: 1.0  #
wic:
  graphviz:
    label: Molecular Dynamics Setup
  steps:
    (1, pdb):
      wic:
        graphviz:
          label: Load Complex PDB File
    (2, extract_molecule):
      wic:
        graphviz:
          label: Extract Protein
    (3, prepare_protein.yml):
      wic:
        graphviz:
          label: Fix Protein
    (4, extract_heteroatoms):
      wic:
        graphviz:
          label: Extract Ligand
    (5, python3_rename_ligand_pdb):
      wic:
        graphviz:
          label: Rename Ligand\Residue to MOL
    (6, prepare_ligand_amber.yml):
      wic:
        graphviz:
          label: Generate Ligand\nTopology & Parameters
    (7, create_complex_amber.yml):
      wic:
        graphviz:
          label: Create Complex\nTopology & Parameters
    (8, stability):
      wic:
        graphviz:
          label: Minimize, Equilibrate the System
