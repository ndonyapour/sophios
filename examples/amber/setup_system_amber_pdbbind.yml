# This is based on the excellent gromacs CWL tutorial
# https://mmb.irbbarcelona.org/biobb/workflows/tutorials/amber_md_setup_lig

steps:
  - extract_molecule:
      in:
        input_structure_path: '/home/ndonyapour/projects/WIC/PDBbind_structures/selected/3kiv/3kiv_protein_noh.pdb'
        output_molecule_path: '&protein.pdb'
  - prepare_protein_amber.yml:
  # - convert_mol2:
  #     in:
  #       input_path: '/home/ndonyapour/projects/WIC/PDBbind_structures/selected/3kiv/3kiv_ligand.sdf'
  #       output_mol2_path: '&ligand_rscb.mol2'
  - python3_mol2_to_mol2:
      in:
        script: /rename_residues_MOL.py # NOTE: Initial / required
        input_mol2_path: '/home/ndonyapour/projects/WIC/PDBbind_structures/selected/3kiv/3kiv_ligand.mol2'
        output_mol2_path: '&ligand_inp.mol2'
        ligand_residue_name: UNL
  - prepare_ligand_amber.yml:
  - create_complex_amber.yml:
  - setup_amber.yml:
      in:
        input_pdb_path: '*complex_min_vac.pdb'
        input_lib_path: '*ligand_params.lib'
        input_frcmod_path: '*ligand_params.frcmod'

  # - stability_amber.yml:
  #     in:
  #       nsteps: 10000
  #       dt: 0.002 # ps
  #       temperature: 298.0 # K
  #       pressure: 1.0  #

# wic:
#   graphviz:
#     label: Molecular Dynamics Setup
#   steps:
#     (1, pdb):
#       wic:
#         graphviz:
#           label: Load the Complex PDB File
#     (2, rename_pdb):
#       wic:
#         graphviz:
#           label: Rename Lignad to MOL
#     (3, extract_molecule):
#       wic:
#         graphviz:
#           label: Extract Protein Coordinates
#     (4, prepare_protein):
#       wic:
#         graphviz:
#           label: Prepare Protein
#     (5, extract_heteroatoms):
#       wic:
#         graphviz:
#           label: Extract Ligand Coordinates
#     (6, prepare_ligand):
#       wic:
#         graphviz:
#           label: Prepare Ligand
#     (7, create_complex):
#       wic:
#         graphviz:
#           label: Create the Complex of Protein and Ligand
#     (8, stability):
#       wic:
#         graphviz:
#           label: Minimize, Equilibrate the System
